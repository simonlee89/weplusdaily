<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vincit - ë‹´ë‹¹ìë³„ ì „ë‚  ë¬¸ì˜í˜„í™©</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <style>
        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
        .calligraphy {
            font-family: 'Georgia', 'Times New Roman', 'ë§‘ì€ ê³ ë”•', serif;
            font-weight: 600;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
            letter-spacing: 0.5px;
        }
    </style>
</head>
<body class="min-h-screen bg-gray-50">
    <div class="min-h-screen bg-gray-50 p-6">
        <div class="max-w-7xl mx-auto">
            <!-- í—¤ë” -->
            <div class="mb-8">
                <!-- Vincit ë¡œê³  (ì™¼ìª½ ìƒë‹¨) -->
                <div class="flex items-baseline mb-6">
                    <h1 class="text-4xl font-bold text-gray-900">Vincit</h1>
                    <span class="ml-2 text-sm text-gray-500 italic">('Amor Vincit Omnia')</span>
                </div>
                
                <!-- ëª…ì–¸ê³¼ ì¸ì‚¬ë§ (ì¤‘ì•™) -->
                <div class="text-center">
                    <div class="calligraphy text-xl text-gray-800 mb-3 leading-relaxed">
                        ë¹„ê´€ë¡ ìëŠ” ëª¨ë“  ê¸°íšŒì—ì„œ ì–´ë ¤ì›€ì„ ì°¾ì•„ë‚´ê³ <br>
                        ë‚™ê´€ë¡ ìëŠ” ëª¨ë“  ì–´ë ¤ì›€ì—ì„œ ê¸°íšŒë¥¼ ì°¾ì•„ë‚¸ë‹¤
                    </div>
                    <div class="text-lg text-blue-600 font-semibold">
                        ì¢‹ì€ì•„ì¹¨ì…ë‹ˆë‹¤! â˜€ï¸ íƒœì¼íŒ€ì¥ì´ ê°€ì¥ ë¹›ë‚˜ëŠ” í•˜ë£¨ë¥¼ ë³´ë‚´ì„¸ìš” ë¯¿ìŠµë‹ˆë‹¤
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-12 gap-6 h-[1200px]">
                <!-- ì™¼ìª½: ë‹´ë‹¹ì ëª©ë¡ -->
                <div class="col-span-3 bg-white rounded-lg shadow-sm border border-gray-200 p-6">
                    <h2 class="text-lg font-semibold text-gray-800 mb-4 text-center">ë‹´ë‹¹ì</h2>
                    
                    <!-- í—¤ë” ë¼ë²¨ -->
                    <div class="flex justify-between items-center px-4 py-3 mb-4 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl border border-blue-100">
                        <div class="flex items-center">
                            <div class="w-2 h-2 bg-blue-500 rounded-full mr-2"></div>
                            <span class="text-sm font-semibold text-blue-700">ë‹´ë‹¹ì</span>
                        </div>
                        <div class="flex items-center">
                            <span class="text-sm font-semibold text-indigo-700">ë¬¸ì˜/ ë§¤ë¬¼</span>
                            <div class="w-2 h-2 bg-indigo-500 rounded-full ml-2"></div>
                        </div>
                    </div>
                    
                    <div class="space-y-3" id="manager-list">
                        <!-- ë‹´ë‹¹ì ëª©ë¡ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                    </div>
                </div>

                <!-- ì¤‘ê°„: ë‹´ë‹¹ë§¤ë¬¼ -->
                <div class="col-span-6 bg-white rounded-lg shadow-sm border border-gray-200 p-6">
                    <h2 class="text-lg font-semibold text-gray-800 mb-4 text-center">ë‹´ë‹¹ë§¤ë¬¼</h2>
                    
                    <!-- í•„í„°ë§ ë²„íŠ¼ -->
                    <div class="flex space-x-2 mb-4">
                        <button id="filter-inquiries" class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors">
                            ë¬¸ì˜ìˆ˜ìˆœ
                        </button>
                        <button id="filter-views" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 transition-colors">
                            ì¡°íšŒìˆ˜ìˆœ
                        </button>
                        <button id="filter-upload-date" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 transition-colors">
                            ì˜¬ë¦°ë‚ ì§œìˆœ
                        </button>
                    </div>
                    
                    <div class="grid grid-cols-1 gap-3 max-h-[1000px] overflow-y-auto scrollbar-hide" id="properties-list">
                        <!-- ë‹´ë‹¹ë§¤ë¬¼ ëª©ë¡ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                    </div>
                </div>

                <!-- ì˜¤ë¥¸ìª½: í†µê³„ ë° ìˆœìœ„ -->
                <div class="col-span-3 bg-white rounded-lg shadow-sm border border-gray-200 p-6">
                    <!-- ì œê±°ëœ ë§¤ë¬¼ ì•Œë¦¼ -->
                    <div id="removed-properties-section" class="mb-6 hidden">
                        <h3 class="text-lg font-semibold text-red-600 mb-3">ğŸš¨ ì œê±°ëœ ì§€ìš¸ ë§¤ë¬¼</h3>
                        <div id="removed-properties-list" class="space-y-2 max-h-32 overflow-y-auto">
                            <!-- ì œê±°ëœ ë§¤ë¬¼ ëª©ë¡ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                        </div>
                        <button onclick="clearRemovedProperties()" class="mt-2 text-xs text-gray-500 hover:text-gray-700">
                            ì•Œë¦¼ ì§€ìš°ê¸°
                        </button>
                    </div>
                    
                    <!-- ìƒë‹¨ í†µê³„ -->
                    <div class="mb-6">
                        <div class="grid grid-cols-1 gap-3">
                            <div class="text-center p-3 bg-blue-50 rounded-lg">
                                <div class="text-xl font-bold text-blue-600" id="total-inquiries">0</div>
                                <div class="text-sm text-gray-600">vincit ì´ë¬¸ì˜</div>
                            </div>
                            <div class="text-center p-3 bg-green-50 rounded-lg">
                                <div class="text-xl font-bold text-green-600" id="average-views">0</div>
                                <div class="text-sm text-gray-600">í‰ê·  ì¡°íšŒìˆ˜</div>
                            </div>
                        </div>
                    </div>
                    
                    <h2 class="text-lg font-semibold text-gray-800 mb-6 text-center">ìˆœìœ„</h2>
                    
                    <div class="space-y-4" id="ranking-list">
                        <!-- ìˆœìœ„ ëª©ë¡ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ë¡œë”© ìŠ¤í”¼ë„ˆ -->
    <div id="loading" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white p-6 rounded-lg">
            <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"></div>
            <p class="mt-2 text-gray-600">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
        </div>
    </div>

    <script>
        let managerData = [];
        let selectedManager = null;
        let currentFilter = 'inquiries'; // 'inquiries', 'views', 'uploadDate'
        
        // ë§¤ë¬¼ ì¶”ì  ê´€ë ¨ í•¨ìˆ˜ë“¤
        function getTodayKey() {
            return new Date().toISOString().split('T')[0]; // YYYY-MM-DD í˜•ì‹
        }
        
        function getTrackedProperties() {
            const today = getTodayKey();
            const stored = localStorage.getItem(`trackedProperties_${today}`);
            return stored ? JSON.parse(stored) : {};
        }
        
        function saveTrackedProperties(trackedProperties) {
            const today = getTodayKey();
            localStorage.setItem(`trackedProperties_${today}`, JSON.stringify(trackedProperties));
        }
        
        function isPropertyTracked(propertyId) {
            const tracked = getTrackedProperties();
            return tracked.hasOwnProperty(propertyId);
        }
        
        function trackProperty(propertyId, propertyData) {
            const tracked = getTrackedProperties();
            tracked[propertyId] = {
                ...propertyData,
                trackedDate: getTodayKey()
            };
            saveTrackedProperties(tracked);
        }
        
        function untrackProperty(propertyId) {
            const tracked = getTrackedProperties();
            delete tracked[propertyId];
            saveTrackedProperties(tracked);
        }
        
        function checkRemovedProperties() {
            // ì–´ì œ ì¶”ì í–ˆë˜ ë§¤ë¬¼ë“¤ í™•ì¸
            const yesterday = new Date();
            yesterday.setDate(yesterday.getDate() - 1);
            const yesterdayKey = yesterday.toISOString().split('T')[0];
            
            const yesterdayTracked = localStorage.getItem(`trackedProperties_${yesterdayKey}`);
            if (!yesterdayTracked) return;
            
            const yesterdayProperties = JSON.parse(yesterdayTracked);
            const currentPropertyIds = new Set();
            
            // í˜„ì¬ ëª¨ë“  ë§¤ë¬¼ ID ìˆ˜ì§‘
            managerData.forEach(manager => {
                if (manager.properties) {
                    manager.properties.forEach(property => {
                        currentPropertyIds.add(property.propertyId);
                    });
                }
            });
            
            // ì œê±°ëœ ë§¤ë¬¼ ì°¾ê¸°
            const removedProperties = [];
            Object.keys(yesterdayProperties).forEach(propertyId => {
                if (!currentPropertyIds.has(propertyId)) {
                    removedProperties.push(yesterdayProperties[propertyId]);
                }
            });
            
            // ì œê±°ëœ ë§¤ë¬¼ í‘œì‹œ
            if (removedProperties.length > 0) {
                displayRemovedProperties(removedProperties);
            }
        }
        
        function displayRemovedProperties(removedProperties) {
            const section = document.getElementById('removed-properties-section');
            const list = document.getElementById('removed-properties-list');
            
            list.innerHTML = '';
            removedProperties.forEach(property => {
                const item = document.createElement('div');
                item.className = 'p-2 bg-red-50 border border-red-200 rounded text-xs';
                item.innerHTML = `
                    <div class="font-semibold text-red-700">${property.managerName} - ${property.propertyId}</div>
                    <div class="text-red-600">${property.address}</div>
                `;
                list.appendChild(item);
            });
            
            section.classList.remove('hidden');
        }
        
        function clearRemovedProperties() {
            document.getElementById('removed-properties-section').classList.add('hidden');
        }

        // ë°ì´í„° ë¡œë“œ
        async function loadData() {
            try {
                const response = await fetch('/api/data');
                const data = await response.json();
                managerData = data;
                
                if (managerData.length > 0) {
                    selectedManager = managerData[0];
                    renderDashboard();
                    checkRemovedProperties(); // ì œê±°ëœ ë§¤ë¬¼ í™•ì¸
                } else {
                    showError('ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                console.error('ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:', error);
                showError('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            } finally {
                document.getElementById('loading').style.display = 'none';
            }
        }

        // ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ
        function showError(message) {
            document.getElementById('loading').innerHTML = `
                <div class="bg-white p-6 rounded-lg">
                    <div class="text-red-600 text-center">
                        <p class="text-lg font-semibold">ì˜¤ë¥˜</p>
                        <p class="mt-2">${message}</p>
                        <button onclick="location.reload()" class="mt-4 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
                            ë‹¤ì‹œ ì‹œë„
                        </button>
                    </div>
                </div>
            `;
        }

        // ëŒ€ì‹œë³´ë“œ ë Œë”ë§
        function renderDashboard() {
            renderManagerList();
            renderProperties();
            renderRanking();
            renderStatistics();
        }

        // ë‹´ë‹¹ì ëª©ë¡ ë Œë”ë§
        function renderManagerList() {
            const managerList = document.getElementById('manager-list');
            managerList.innerHTML = '';

            managerData.forEach(manager => {
                const isSelected = selectedManager && selectedManager.name === manager.name;
                const propertyCount = manager.properties ? manager.properties.length : 0;
                const managerElement = document.createElement('div');
                managerElement.className = `px-3 py-2 rounded-lg border-2 cursor-pointer transition-all ${
                    isSelected
                        ? 'bg-gradient-to-r from-blue-500 to-indigo-500 text-white border-blue-500 shadow-lg'
                        : 'bg-white text-gray-700 border-gray-200 hover:border-blue-300 hover:shadow-md'
                }`;
                
                managerElement.innerHTML = `
                    <div class="flex flex-col space-y-1">
                        <div class="flex justify-between items-center">
                            <span class="font-semibold">${manager.name}</span>
                            ${isSelected ? 
                                '<div class="w-2 h-2 bg-white rounded-full"></div>' : 
                                '<div class="w-2 h-2 bg-blue-500 rounded-full"></div>'
                            }
                        </div>
                        <div class="text-sm ${isSelected ? 'text-blue-100' : 'text-gray-600'}">
                            <div class="mb-1">
                                ë¬¸ì˜: <span class="font-bold ${isSelected ? 'text-white' : 'text-blue-600'}">${manager.totalInquiries || 0}</span> / 
                                <span class="font-bold ${isSelected ? 'text-white' : 'text-red-600'}">${manager.yesterdayInquiries || 0}</span> 
                                <span class="text-gray-400">(ì–´ì œ)</span>
                            </div>
                            <div>
                                ë§¤ë¬¼: <span class="font-bold ${isSelected ? 'text-white' : 'text-indigo-600'}">${propertyCount}</span>
                            </div>
                        </div>
                    </div>
                `;
                
                managerElement.addEventListener('click', () => {
                    selectedManager = manager;
                    renderDashboard();
                });
                
                managerList.appendChild(managerElement);
            });
        }

        // ë‹´ë‹¹ë§¤ë¬¼ ë Œë”ë§
        function renderProperties() {
            const propertiesList = document.getElementById('properties-list');
            propertiesList.innerHTML = '';

            if (!selectedManager || !selectedManager.properties) return;

            // í˜„ì¬ í•„í„°ì— ë”°ë¼ ì •ë ¬
            let sortedProperties;
            if (currentFilter === 'inquiries') {
                sortedProperties = [...selectedManager.properties].sort((a, b) => b.inquiries - a.inquiries);
            } else if (currentFilter === 'views') {
                sortedProperties = [...selectedManager.properties].sort((a, b) => b.dailyViews - a.dailyViews);
            } else if (currentFilter === 'uploadDate') {
                sortedProperties = [...selectedManager.properties].sort((a, b) => a.uploadDays - b.uploadDays);
            }

            sortedProperties.forEach(property => {
                const propertyElement = document.createElement('div');
                propertyElement.className = 'border border-gray-200 rounded-lg p-4';
                
                propertyElement.innerHTML = `
                    <div class="grid grid-cols-5 gap-4 items-center">
                        <div class="text-center">
                            <div class="text-xs text-gray-500 mb-1">ë§¤ë¬¼ë²ˆí˜¸</div>
                            <div class="font-medium text-blue-600">${property.propertyId}</div>
                        </div>
                        <div class="col-span-2">
                            <div class="text-xs text-gray-500 mb-1">ì£¼ì†Œ</div>
                            <div class="text-sm font-medium">${property.address}</div>
                        </div>
                        <div class="text-center">
                            <div class="text-xs text-gray-500 mb-1">ê¸ˆì•¡</div>
                            <div class="font-bold text-green-600">${property.amount}</div>
                        </div>
                        <div class="text-center">
                            <div class="text-xs text-gray-500 mb-1">ì¡°íšŒìˆ˜</div>
                            <div class="font-bold text-purple-600">${property.dailyViews}íšŒ</div>
                            <div class="text-xs text-gray-400 mt-1">ì˜¬ë¦°ë‚ ì§œ ${property.uploadDays}ì¼</div>
                        </div>
                    </div>
                    <div class="mt-2 text-center">
                        <div class="flex items-center justify-center space-x-3">
                            <span class="bg-red-500 text-white text-xs px-3 py-1 rounded-full">
                                ë¬¸ì˜ ${property.inquiries}ê±´
                            </span>
                            <div class="flex items-center">
                                <input type="checkbox" 
                                       id="track-${property.propertyId}" 
                                       class="property-tracker w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500"
                                       data-property-id="${property.propertyId}"
                                       data-property-address="${property.address}"
                                       data-manager-name="${selectedManager.name}"
                                       ${isPropertyTracked(property.propertyId) ? 'checked' : ''}>
                                <label for="track-${property.propertyId}" class="ml-1 text-xs text-gray-600">ì§€ìš¸ë§¤ë¬¼</label>
                            </div>
                        </div>
                    </div>
                `;
                
                propertiesList.appendChild(propertyElement);
            });
            
            // ì²´í¬ë°•ìŠ¤ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
            document.querySelectorAll('.property-tracker').forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    const propertyId = this.dataset.propertyId;
                    const propertyAddress = this.dataset.propertyAddress;
                    const managerName = this.dataset.managerName;
                    
                    if (this.checked) {
                        trackProperty(propertyId, {
                            propertyId: propertyId,
                            address: propertyAddress,
                            managerName: managerName
                        });
                    } else {
                        untrackProperty(propertyId);
                    }
                });
            });
        }

        // ìˆœìœ„ ë Œë”ë§
        function renderRanking() {
            const rankingList = document.getElementById('ranking-list');
            rankingList.innerHTML = '';

            const rankedManagers = [...managerData].sort((a, b) => (b.totalInquiries || 0) - (a.totalInquiries || 0));

            rankedManagers.forEach((manager, index) => {
                const rankElement = document.createElement('div');
                rankElement.className = 'flex items-center justify-between p-3 rounded-lg border border-gray-200';
                
                const rankBadgeClass = index === 0 ? 'bg-yellow-400 text-white' :
                                     index === 1 ? 'bg-gray-400 text-white' :
                                     index === 2 ? 'bg-orange-400 text-white' :
                                     'bg-gray-100 text-gray-600';
                
                rankElement.innerHTML = `
                    <div class="flex items-center">
                        <div class="w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold mr-3 ${rankBadgeClass}">
                            ${index + 1}
                        </div>
                        <span class="font-medium text-gray-900">${manager.name}</span>
                    </div>
                    <div class="text-center">
                        <div class="text-lg font-bold text-blue-600">${manager.totalInquiries || 0}</div>
                        <div class="text-xs text-gray-500">ê±´</div>
                    </div>
                `;
                
                rankingList.appendChild(rankElement);
            });
        }

        // í†µê³„ ë Œë”ë§
        function renderStatistics() {
            const totalInquiries = managerData.reduce((sum, manager) => sum + (manager.totalInquiries || 0), 0);
            
            // í‰ê·  ì¡°íšŒìˆ˜ ê³„ì‚°
            let totalViews = 0;
            let totalProperties = 0;
            managerData.forEach(manager => {
                if (manager.properties) {
                    manager.properties.forEach(property => {
                        totalViews += property.dailyViews;
                        totalProperties++;
                    });
                }
            });
            const averageViews = totalProperties > 0 ? Math.round(totalViews / totalProperties) : 0;

            document.getElementById('total-inquiries').textContent = totalInquiries;
            document.getElementById('average-views').textContent = averageViews;
        }

        // í•„í„° ë²„íŠ¼ ì—…ë°ì´íŠ¸
        function updateFilterButtons() {
            const inquiriesBtn = document.getElementById('filter-inquiries');
            const viewsBtn = document.getElementById('filter-views');
            const uploadDateBtn = document.getElementById('filter-upload-date');
            
            // ëª¨ë“  ë²„íŠ¼ì„ ê¸°ë³¸ ìƒíƒœë¡œ ì´ˆê¸°í™”
            inquiriesBtn.className = 'px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 transition-colors';
            viewsBtn.className = 'px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 transition-colors';
            uploadDateBtn.className = 'px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 transition-colors';
            
            // í˜„ì¬ í•„í„°ì— ë”°ë¼ í™œì„±í™”
            if (currentFilter === 'inquiries') {
                inquiriesBtn.className = 'px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors';
            } else if (currentFilter === 'views') {
                viewsBtn.className = 'px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors';
            } else if (currentFilter === 'uploadDate') {
                uploadDateBtn.className = 'px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors';
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹¤í–‰
        document.addEventListener('DOMContentLoaded', () => {
            loadData();
            
            // í•„í„° ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            document.getElementById('filter-inquiries').addEventListener('click', () => {
                currentFilter = 'inquiries';
                updateFilterButtons();
                renderProperties();
            });
            
            document.getElementById('filter-views').addEventListener('click', () => {
                currentFilter = 'views';
                updateFilterButtons();
                renderProperties();
            });
            
            document.getElementById('filter-upload-date').addEventListener('click', () => {
                currentFilter = 'uploadDate';
                updateFilterButtons();
                renderProperties();
            });
        });
    </script>
</body>
</html> 